<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Aposentadoria - Vers√£o Corrigida</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .calculator-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 800px;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 40px;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }
        
        .input-group input, .input-group select {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .calculate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            margin: 20px 0;
            transition: transform 0.3s;
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
        }
        
        .result-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            display: none;
            border-left: 5px solid #667eea;
        }
        
        .result-age {
            font-size: 48px;
            font-weight: 800;
            color: #1a237e;
            text-align: center;
            margin: 20px 0;
        }
        
        .result-details {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            color: #666;
        }
        
        .detail-value {
            font-weight: 600;
            color: #1a237e;
        }
        
        .warning {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .disclaimer {
            font-size: 12px;
            color: #999;
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .scenarios {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }
        
        .scenario-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .scenario-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .scenario-value {
            font-size: 24px;
            font-weight: 700;
            color: #1a237e;
        }
        
        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .result-age {
                font-size: 36px;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="header">
            <h1>üïí Calculadora de Aposentadoria Corrigida</h1>
            <p>C√°lculos precisos considerando infla√ß√£o e juros compostos</p>
        </div>
        
        <div class="content">
            <div class="input-grid">
                <div class="input-group">
                    <label for="age">Idade atual</label>
                    <input type="number" id="age" value="35" min="18" max="70">
                </div>
                
                <div class="input-group">
                    <label for="retirementAge">Idade desejada para aposentar</label>
                    <input type="number" id="retirementAge" value="55" min="40" max="100">
                </div>
                
                <div class="input-group">
                    <label for="patrimony">Patrim√¥nio atual investido (R$)</label>
                    <input type="number" id="patrimony" value="50000">
                </div>
                
                <div class="input-group">
                    <label for="monthly">Aporte mensal (R$)</label>
                    <input type="number" id="monthly" value="1500">
                </div>
                
                <div class="input-group">
                    <label for="monthlyIncome">Renda mensal desejada na aposentadoria (em valores de HOJE)</label>
                    <input type="number" id="monthlyIncome" value="10000">
                </div>
                
                <div class="input-group">
                    <label for="returnRate">Rentabilidade anual esperada (%)</label>
                    <select id="returnRate">
                        <option value="0.06">6% (Conservador - Renda Fixa)</option>
                        <option value="0.08" selected>8% (Moderado - Misturado)</option>
                        <option value="0.10">10% (Agressivo - A√ß√µes)</option>
                        <option value="0.12">12% (Muito Agressivo)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="inflation">Infla√ß√£o anual projetada (%)</label>
                    <select id="inflation">
                        <option value="0.035">3.5% (Otimista)</option>
                        <option value="0.045" selected>4.5% (Hist√≥rica Brasil)</option>
                        <option value="0.055">5.5% (Pessimista)</option>
                    </select>
                </div>
            </div>
            
            <button class="calculate-btn" onclick="calculateRetirement()">
                üßÆ CALCULAR COM PRECIS√ÉO
            </button>
            
            <div class="result-section" id="resultSection">
                <h2 style="text-align: center; color: #333;">üìä Resultado da Proje√ß√£o</h2>
                
                <div class="result-age" id="resultAge">--</div>
                
                <div class="result-details">
                    <div class="detail-row">
                        <span class="detail-label">Anos at√© aposentadoria:</span>
                        <span class="detail-value" id="yearsToGo">--</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Patrim√¥nio necess√°rio (valor futuro):</span>
                        <span class="detail-value" id="neededPatrimony">--</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Sua renda na aposentadoria (valor futuro):</span>
                        <span class="detail-value" id="futureIncome">--</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Patrim√¥nio projetado (valor futuro):</span>
                        <span class="detail-value" id="projectedPatrimony">--</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Falta para meta:</span>
                        <span class="detail-value" id="missingAmount">--</span>
                    </div>
                </div>
                
                <div class="warning" id="warningMessage" style="display: none;">
                    ‚ö†Ô∏è <strong>Aten√ß√£o:</strong> Sua proje√ß√£o atual n√£o atingir√° a meta. Veja abaixo como melhorar:
                </div>
                
                <h3 style="margin: 25px 0 15px 0; color: #333;">üìà Cen√°rios para Atingir sua Meta:</h3>
                
                <div class="scenarios">
                    <div class="scenario-card">
                        <div class="scenario-title">Aumentando aporte em 20%</div>
                        <div class="scenario-value" id="scenario1">-- anos</div>
                    </div>
                    
                    <div class="scenario-card">
                        <div class="scenario-title">Melhorando rentabilidade em 2%</div>
                        <div class="scenario-value" id="scenario2">-- anos</div>
                    </div>
                    
                    <div class="scenario-card">
                        <div class="scenario-title">Ambos ajustes</div>
                        <div class="scenario-value" id="scenario3">-- anos</div>
                    </div>
                    
                    <div class="scenario-card">
                        <div class="scenario-title">Aposentar 5 anos depois</div>
                        <div class="scenario-value" id="scenario4">-- anos</div>
                    </div>
                </div>
            </div>
            
            <div class="disclaimer">
                * C√°lculos consideram juros compostos e infla√ß√£o. Valores em "valor futuro" j√° incluem corre√ß√£o monet√°ria. 
                Esta √© uma proje√ß√£o matem√°tica, n√£o garantia de resultado. Consulte um planejador financeiro.
            </div>
        </div>
    </div>

    <script>
        // Formatar moeda
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }
        
        // C√°lculo PRECISO da aposentadoria
        function calculateRetirement() {
            // Coletar dados
            const currentAge = parseFloat(document.getElementById('age').value);
            const desiredAge = parseFloat(document.getElementById('retirementAge').value);
            const currentPatrimony = parseFloat(document.getElementById('patrimony').value);
            const monthlyContribution = parseFloat(document.getElementById('monthly').value);
            const desiredMonthlyIncome = parseFloat(document.getElementById('monthlyIncome').value);
            const annualReturn = parseFloat(document.getElementById('returnRate').value);
            const annualInflation = parseFloat(document.getElementById('inflation').value);
            
            // 1. Calcular anos at√© aposentadoria
            const yearsToRetirement = desiredAge - currentAge;
            
            if (yearsToRetirement <= 0) {
                alert("A idade desejada deve ser maior que a idade atual!");
                return;
            }
            
            // 2. Calcular RENDA FUTURA (corrigindo pela infla√ß√£o)
            // FV = PV * (1 + i)^n
            const futureMonthlyIncome = desiredMonthlyIncome * Math.pow(1 + annualInflation, yearsToRetirement);
            
            // 3. Calcular PATRIM√îNIO NECESS√ÅRIO (usando perpetuidade)
            // Considerando que o patrim√¥nio rende e a pessoa retira a renda mensal
            const neededPatrimony = (futureMonthlyIncome * 12) / annualReturn;
            
            // 4. Calcular PATRIM√îNIO PROJETADO (juros compostos com aportes mensais)
            // FV = PV*(1+r)^n + PMT*[((1+r)^n - 1)/r]
            const monthlyReturn = Math.pow(1 + annualReturn, 1/12) - 1;
            const months = yearsToRetirement * 12;
            
            const futureValueOfCurrent = currentPatrimony * Math.pow(1 + annualReturn, yearsToRetirement);
            const futureValueOfContributions = monthlyContribution * 
                ((Math.pow(1 + monthlyReturn, months) - 1) / monthlyReturn) * 
                (1 + monthlyReturn);
            
            const projectedPatrimony = futureValueOfCurrent + futureValueOfContributions;
            
            // 5. Verificar se atinge a meta
            const missingAmount = Math.max(0, neededPatrimony - projectedPatrimony);
            const canRetire = projectedPatrimony >= neededPatrimony;
            
            // 6. Calcular idade REAL de aposentadoria se n√£o atingir
            let actualRetirementAge = desiredAge;
            
            if (!canRetire) {
                // Resolver equa√ß√£o para encontrar n (anos) onde FV = neededPatrimony
                // Usando m√©todo iterativo (Newton-Raphson simplificado)
                let n = yearsToRetirement;
                let fv;
                
                for (let i = 0; i < 20; i++) {
                    const months = n * 12;
                    const fvCurrent = currentPatrimony * Math.pow(1 + annualReturn, n);
                    const fvContributions = monthlyContribution * 
                        ((Math.pow(1 + monthlyReturn, months) - 1) / monthlyReturn) * 
                        (1 + monthlyReturn);
                    
                    fv = fvCurrent + fvContributions;
                    
                    const futureIncomeNeeded = desiredMonthlyIncome * Math.pow(1 + annualInflation, n);
                    const neededPatrimonyAtN = (futureIncomeNeeded * 12) / annualReturn;
                    
                    const derivative = currentPatrimony * Math.log(1 + annualReturn) * Math.pow(1 + annualReturn, n) +
                                     monthlyContribution * 12 * Math.pow(1 + annualReturn, n);
                    
                    n = n - (fv - neededPatrimonyAtN) / derivative;
                }
                
                actualRetirementAge = currentAge + Math.max(n, yearsToRetirement);
            }
            
            // 7. Calcular cen√°rios alternativos
            const scenarios = calculateScenarios(
                currentAge, currentPatrimony, monthlyContribution, 
                desiredMonthlyIncome, annualReturn, annualInflation, 
                desiredAge
            );
            
            // 8. Exibir resultados
            displayResults(
                canRetire, actualRetirementAge, yearsToRetirement,
                neededPatrimony, futureMonthlyIncome, projectedPatrimony,
                missingAmount, scenarios
            );
        }
        
        // Calcular cen√°rios alternativos
        function calculateScenarios(currentAge, currentPatrimony, monthlyContribution, 
                                   desiredMonthlyIncome, annualReturn, annualInflation, 
                                   desiredAge) {
            
            const yearsToRetirement = desiredAge - currentAge;
            
            // Cen√°rio 1: Aumento de aporte em 20%
            const newContribution1 = monthlyContribution * 1.2;
            const age1 = calculateRetirementAge(
                currentAge, currentPatrimony, newContribution1,
                desiredMonthlyIncome, annualReturn, annualInflation
            );
            
            // Cen√°rio 2: Melhor rentabilidade (+2%)
            const newReturn2 = annualReturn + 0.02;
            const age2 = calculateRetirementAge(
                currentAge, currentPatrimony, monthlyContribution,
                desiredMonthlyIncome, newReturn2, annualInflation
            );
            
            // Cen√°rio 3: Combina√ß√£o
            const age3 = calculateRetirementAge(
                currentAge, currentPatrimony, newContribution1,
                desiredMonthlyIncome, newReturn2, annualInflation
            );
            
            // Cen√°rio 4: Aposentar 5 anos depois
            const age4 = desiredAge + 5;
            
            return {
                scenario1: age1,
                scenario2: age2,
                scenario3: age3,
                scenario4: age4
            };
        }
        
        // Calcular idade de aposentadoria para dado conjunto de par√¢metros
        function calculateRetirementAge(currentAge, currentPatrimony, monthlyContribution,
                                       desiredMonthlyIncome, annualReturn, annualInflation) {
            
            // M√©todo iterativo simplificado
            let n = 20; // Come√ßar com 20 anos
            const monthlyReturn = Math.pow(1 + annualReturn, 1/12) - 1;
            
            for (let iter = 0; iter < 10; iter++) {
                const months = n * 12;
                
                // Patrim√¥nio projetado
                const fvCurrent = currentPatrimony * Math.pow(1 + annualReturn, n);
                const fvContributions = monthlyContribution * 
                    ((Math.pow(1 + monthlyReturn, months) - 1) / monthlyReturn) * 
                    (1 + monthlyReturn);
                const projected = fvCurrent + fvContributions;
                
                // Patrim√¥nio necess√°rio
                const futureIncome = desiredMonthlyIncome * Math.pow(1 + annualInflation, n);
                const needed = (futureIncome * 12) / annualReturn;
                
                // Ajustar n
                const error = projected - needed;
                n = n - (error / (needed * 0.1)); // Aproxima√ß√£o da derivada
                
                if (Math.abs(error) < 0.01) break;
            }
            
            return currentAge + Math.max(n, 0);
        }
        
        // Exibir resultados
        function displayResults(canRetire, actualAge, yearsToGo, 
                              neededPatrimony, futureIncome, projectedPatrimony,
                              missingAmount, scenarios) {
            
            // Mostrar se√ß√£o
            document.getElementById('resultSection').style.display = 'block';
            
            // Resultado principal
            if (canRetire) {
                document.getElementById('resultAge').innerHTML = 
                    `‚úÖ ${actualAge.toFixed(1)} anos`;
                document.getElementById('resultAge').style.color = '#1b5e20';
                document.getElementById('warningMessage').style.display = 'none';
            } else {
                document.getElementById('resultAge').innerHTML = 
                    `‚è≥ ${actualAge.toFixed(1)} anos`;
                document.getElementById('resultAge').style.color = '#c62828';
                document.getElementById('warningMessage').style.display = 'block';
            }
            
            // Detalhes
            document.getElementById('yearsToGo').textContent = 
                `${(actualAge - parseFloat(document.getElementById('age').value)).toFixed(1)} anos`;
            document.getElementById('neededPatrimony').textContent = 
                formatCurrency(neededPatrimony);
            document.getElementById('futureIncome').textContent = 
                formatCurrency(futureIncome);
            document.getElementById('projectedPatrimony').textContent = 
                formatCurrency(projectedPatrimony);
            document.getElementById('missingAmount').textContent = 
                formatCurrency(missingAmount);
            
            // Cen√°rios
            document.getElementById('scenario1').textContent = 
                `${scenarios.scenario1.toFixed(1)} anos`;
            document.getElementById('scenario2').textContent = 
                `${scenarios.scenario2.toFixed(1)} anos`;
            document.getElementById('scenario3').textContent = 
                `${scenarios.scenario3.toFixed(1)} anos`;
            document.getElementById('scenario4').textContent = 
                `${scenarios.scenario4.toFixed(1)} anos`;
        }
        
        // Calcular ao carregar a p√°gina
        window.addEventListener('load', calculateRetirement);
    </script>
</body>
</html>
